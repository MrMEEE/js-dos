<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>Digger Example</title>
        <script src="/v7/build/releases/latest/emulators/emulators.js"></script>
        <script src="/v7/build/releases/latest/emulators-ui/emulators-ui.js"></script>
        <link rel="stylesheet" href="/v7/build/releases/latest/emulators-ui/emulators-ui.css">
        <link rel="stylesheet" href="examples.css">
    </head>

    <body>
        <div class="layout">
            <div class="controls">
                <Button onclick="javascript:start()">Start</Button>
                <Button onclick="javascript:stop()">Stop</Button>
                <Select id="impl-select">
                    <option value="dos-worker" selected>dos worker</option>
                    <option value="dos-direct">dos direct</option>
                </Select>
            </div>
            <div id="root" style="width: 100%; height: 100%;"></div>
        </div>
        <script>
         emulators.pathPrefix = "/v7/build/releases/latest/emulators/";

         let ciPromise = null;
         const layers = emulatorsUi.dom.layers(document.getElementById("root"));

         async function start() {
             stop();

             layers.showLoadingLayer();

             const implName = document.getElementById("impl-select").value;
             const bundleUrl = "https://cdn.dos.zone/original/2X/2/24b00b14f118580763440ecaddcc948f8cb94f14.jsdos";
             const bundle = await emulatorsUi.network.resolveBundle(bundleUrl);

             if (implName === "dos-worker") {
                 ciPromise = emulators.dosWorker(bundle);
             } else {
                 ciPromise = emulators.dosDirect(bundle);
             }

             ciPromise.then((ci) => {
                 const mapper = {
                     88/*KBD_x*/: 290 /*KBD_f1*/,
                 };

                 const mapping = [
                     { joystickId: 0, event: "dir:up", mapTo: 265 /*KBD_up*/ },
                     { joystickId: 0, event: "dir:down", mapTo: 264 /*KBD_down*/ },
                     { joystickId: 0, event: "dir:left", mapTo: 263 /*KBD_left*/ },
                     { joystickId: 0, event: "dir:right", mapTo: 262 /*KBD_right*/ },
                     { joystickId: 0, event: "tap", mapTo: 290 /*KBD_f1*/ },
                     { joystickId: 1, event: "tap", mapTo: 290 /*KBD_f1*/ },
                 ];

                 const buttons = [
                     {
                         action: "click",
                         mapTo: 88 /*KBD_x*/,
                         position: {
                             left: 1,
                             bottom: 1,
                         }
                     },
                 ];

                 emulatorsUi.graphics.webGl(layers, ci);
                 emulatorsUi.sound.audioNode(ci);
                 emulatorsUi.controls.keyboard(layers, ci, mapper);
                 emulatorsUi.controls.button(layers, ci, buttons);
                 emulatorsUi.controls.nipple(layers, ci, mapping);
                 layers.hideLoadingLayer();
             });
         }

         function stop() {
             if (ciPromise !== null) {
                 ciPromise.then((ci) => ci.exit());
             }
         }
        </script>
    </body>
</html>
